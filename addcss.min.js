// http://rocktronica.github.com/Add-CSS-Bookmarklet/
(function(){function d(a){window.addCss=function(){var a=a||window.jQuery,b=a(window),c=a(document),d={};if(document.getElementById("txtAddCss")){a("#txtAddCss").toggle();return false}var e=500;var f={localStorage:function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(a){return false}}(),dynamicStyle:true};var g=a("<div />",{id:"containerAddCss"}).appendTo(a("body"));var h={parse:function(a){m(a)},replace:function(){h=new less.Parser}};if(window.less&&window.less.Parser){h.replace()}else{a.getScript("http://cdnjs.cloudflare.com/ajax/libs/less.js/1.3.0/less-1.3.0.min.js",h.replace)}var i=a("<style />",{id:"styleAddCss"}).html("/**/").appendTo(a("body"));a("<link />",{rel:"stylesheet",type:"text/css",href:location.hostname.match("localhost")?"/addcss.css":"http://rocktronica.github.com/Add-CSS-Bookmarklet/addcss.css"}).appendTo(g);var j=a("<textarea />",{id:"txtAddCss",spellcheck:false}).appendTo(g).focus();var k=a("<span />",{id:"spAddCssHandle"}).appendTo(g);if(document.getElementById("styleAddCss").innerHTML!=="/**/"){f.dynamicStyle=false;e=1e3}var l=function(a){h.parse(a,function(b,c){if(b){return false}m(c.toCSS());if(f.localStorage){localStorage.addCss=a}})};var m=function(b){if(f.dynamicStyle){i.html(b)}else{i.replaceWith("<style id='styleAddCss'>"+b+"</style>");i=a(document.getElementById("styleAddCss"))}};(function(){function b(a){if(a.selectionStart){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();if(b==null){return 0}var c=a.createTextRange(),d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return d.text.length}return 0}function c(a,b){if(a.setSelectionRange){a.setSelectionRange(b,b)}else if(input.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}var a={ESC:27,TAB:9};j.bind("keyup change",function(){d.keyup=d.keyup||setTimeout(function(){var a=j.val();l(a);d.keyup=undefined},e)}).bind("keydown",function(d){var e=d.which;if(e===a.ESC){j.toggle()}else if(e===a.TAB){var f=j.val(),g=b(j[0]);j.val(f.substr(0,g)+"	"+f.substr(g));g++;c(j[0],g);return false}})})();if(f.localStorage){if(localStorage.addCss){j.val(localStorage.addCss).change()}if(localStorage.addCssCss){j.css(a.parseJSON(localStorage.addCssCss))}}(function(){function g(){var a=40;var c={width:b.width(),height:b.height()};var f={width:j.width(),height:j.height()};if(c.width<f.width+a){var g=c.width-a;j.css("width",g);e.start.width=g}if(c.height<f.height+a){var h=c.height-a;j.css("height",h);e.start.height=h}d.windowResize=undefined}var a={start:{},diff:{}},e={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};var h={startDrag:function(b){a.start={x:b.clientX||b.pageX,y:b.clientY||b.pageY};c.on("mousemove",h.onMouseMove).on("mouseup",h.endDrag).on("keypress",h.endDrag);return false},onMouseMove:function(b){a.diff.x=a.start.x-(b.clientX||b.pageX);a.diff.y=a.start.y-(b.clientY||b.pageY);e.end.width=e.start.width+a.diff.x;e.end.height=e.start.height+a.diff.y;j.css(e.end)},endDrag:function(b){if(f.localStorage){localStorage.addCssCss=JSON.stringify(e.end)}a.diff={x:0,y:0},e={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};c.off("mousemove",h.onMouseMove).off("mouseup",h.endDrag).off("keypress",h.endDrag);g();return false}};k.on("mousedown",h.startDrag);b.on("resize",function(){d.windowResize=d.windowResize||setTimeout(g,10)}).resize()})()};window.addCss()}var a="1.7";if(window.jQuery===undefined||window.jQuery.fn.jquery<a){var b=false;var c=document.createElement("script");c.src="http://ajax.googleapis.com/ajax/libs/jquery/"+a+"/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){b=true;d(jQuery)}};document.getElementsByTagName("head")[0].appendChild(c)}else{d(jQuery)}})()