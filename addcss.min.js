// http://rocktronica.github.com/Add-CSS-Bookmarklet/
(function(){function d(a){window.addCss=function(){function d(a,b){if(a.setSelectionRange){a.setSelectionRange(b,b)}else if(input.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}function c(a){if(a.selectionStart){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();if(b==null){return 0}var c=a.createTextRange(),d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return d.text.length}return 0}var a=window.jQuery,b;if(document.getElementById("txtAddCss")){a("#txtAddCss").toggle();return false}var e=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(a){return false}}();var f=a("<div />").css({position:"fixed",bottom:"10px",right:"10px","z-index":"1000"}).appendTo(a("body"));var g=a("<style id='styleAddCss'>/**/</style>").appendTo(a("body")),h=true,i=500;var j=a("<textarea id='txtAddCss' spellcheck='false' style=\"resize:both; display:block; background-color:#111; background:rgba(0,0,0,.9); color:#fff; border:1px solid #000; outline:none; width:400px; height:200px; font:13px/18px 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace; padding:10px; overflow:auto; resize:none;\" />").css({});if(document.getElementById("styleAddCss").innerHTML!=="/**/"){h=false;i=1e3}j.bind("keyup change",function(){b=b||setTimeout(function(){var c=j.val();if(h){g.html(c)}else{g.replaceWith("<style id='styleAddCss'>"+c+"</style>");g=a(document.getElementById("styleAddCss"))}if(e){localStorage.addCss=c}b=undefined},i)}).bind("keydown",function(a){if(a.which===27){j.toggle()}else if(a.which===9){var b=j.val(),e=c(j[0]);j.val(b.substr(0,e)+"\t"+b.substr(e));e++;d(j[0],e);return false}}).appendTo(f).focus();if(e){if(localStorage.addCss){j.val(localStorage.addCss).change()}if(localStorage.addCssCss){j.css(a.parseJSON(localStorage.addCssCss))}}var k={start:{},diff:{}},l={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};var m={startDrag:function(b){k.start={x:b.clientX||b.pageX,y:b.clientY||b.pageY};a(document).on("mousemove",m.onMouseMove);a(document).on("mouseup",m.endDrag);a(document).on("keypress",m.endDrag);return false},onMouseMove:function(a){k.diff.x=k.start.x-(a.clientX||a.pageX);k.diff.y=k.start.y-(a.clientY||a.pageY);l.end.width=l.start.width+k.diff.x;l.end.height=l.start.height+k.diff.y;j.css(l.end)},endDrag:function(b){if(e){localStorage.addCssCss=JSON.stringify(l.end)}k.diff={x:0,y:0},l={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};a(document).off("mousemove",m.onMouseMove);a(document).off("mouseup",m.endDrag);a(document).off("keypress",m.endDrag);return false}};var n=a("<span id='spAddCssHandle' />").css({border:"8px solid #fff",position:"absolute",top:0,left:0,"border-right-color":"transparent","border-bottom-color":"transparent",opacity:".1",cursor:"nw-resize"}).appendTo(f).on("mousedown",m.startDrag)};window.addCss()}var a="1.7";if(window.jQuery===undefined||window.jQuery.fn.jquery<a){var b=false;var c=document.createElement("script");c.src="http://ajax.googleapis.com/ajax/libs/jquery/"+a+"/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){b=true;d(jQuery)}};document.getElementsByTagName("head")[0].appendChild(c)}else{d(jQuery)}})()