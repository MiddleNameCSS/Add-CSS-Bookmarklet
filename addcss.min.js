// http://rocktronica.github.com/Add-CSS-Bookmarklet/
(function(){function d(a){window.addCss=function(){function c(a,b){if(a.setSelectionRange){a.setSelectionRange(b,b)}else if(input.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}function b(a){if(a.selectionStart){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();if(b==null){return 0}var c=a.createTextRange(),d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return d.text.length}return 0}var a=window.jQuery;if(document.getElementById("txtAddCss")){a("#txtAddCss").toggle();return false}var d=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(a){return false}}();var e=a("<div />").css({position:"fixed",bottom:"10px",right:"10px","z-index":"1000"}).appendTo(a("body"));var f=a("<style />").appendTo(a("body"));var g=a("<textarea id='txtAddCss' spellcheck='false' />").css({resize:"both",display:"block",background:"rgba(0,0,0,.9)",color:"#fff",border:"1px solid #000",outline:"none",width:"400px",height:"200px",font:'13px/18px "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace',padding:"10px",overflow:"auto",resize:"none"}).bind("keyup change",function(){var a=g.val();f.html(a);if(d){localStorage.addCss=a}}).bind("keydown",function(a){if(a.which===27){g.toggle()}else if(a.which===9){var d=g.val(),e=b(g[0]);g.val(d.substr(0,e)+"\t"+d.substr(e));e++;c(g[0],e);return false}}).appendTo(e).focus();if(d){if(localStorage.addCss){g.val(localStorage.addCss).change()}if(localStorage.addCssCss){g.css(a.parseJSON(localStorage.addCssCss))}}var h={start:{},diff:{}},i={start:{width:g.width(),height:g.height()},end:{width:undefined,height:undefined}};var j={startDrag:function(b){h.start={x:b.clientX||b.pageX,y:b.clientY||b.pageY};a(document).on("mousemove",j.onMouseMove);a(document).on("mouseup",j.endDrag);return false},onMouseMove:function(a){h.diff.x=h.start.x-(a.clientX||a.pageX);h.diff.y=h.start.y-(a.clientY||a.pageY);i.end.width=i.start.width+h.diff.x;i.end.height=i.start.height+h.diff.y;g.css(i.end)},endDrag:function(b){if(d){localStorage.addCssCss=JSON.stringify(i.end)}h.diff={x:0,y:0},i={start:{width:g.width(),height:g.height()},end:{width:undefined,height:undefined}};a(document).off("mousemove",j.onMouseMove);a(document).off("mouseup",j.endDrag);return false}};var k=a("<span id='spAddCssHandle' />").css({border:"8px solid #fff",position:"absolute",top:0,left:0,"border-right-color":"transparent","border-bottom-color":"transparent",opacity:".1",cursor:"nw-resize"}).appendTo(e).on("mousedown",j.startDrag)};window.addCss()}var a="1.7";if(window.jQuery===undefined||window.jQuery.fn.jquery<a){var b=false;var c=document.createElement("script");c.src="http://ajax.googleapis.com/ajax/libs/jquery/"+a+"/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){b=true;d(jQuery)}};document.getElementsByTagName("head")[0].appendChild(c)}else{d(jQuery)}})()