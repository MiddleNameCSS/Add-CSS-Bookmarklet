// http://rocktronica.github.com/Add-CSS-Bookmarklet/
(function(){var v="1.7";if(window.jQuery===undefined||window.jQuery.fn.jquery<v){var l=false;var m=document.createElement("script");m.src="http://ajax.googleapis.com/ajax/libs/jquery/"+v+"/jquery.min.js";m.onload=m.onreadystatechange=function(){if(!l&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){l=true;initAddCss(jQuery)}};document.getElementsByTagName("head")[0].appendChild(m)}else{initAddCss(jQuery)}function initAddCss($){window.addCss=function(){var $=window.jQuery,throttle={},$window=$(window);if(document.getElementById("txtAddCss")){$("#txtAddCss").toggle();return false}var f=(function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(a){return false}})();var g=$("<div />").css({position:"fixed",bottom:"10px",right:"10px","z-index":"1000"}).appendTo($("body"));var h=$("<style id='styleAddCss'>/**/</style>").appendTo($("body")),bDynamicStyle=true,iThrottle=500;var i=$("<style type='text/css'> 				#txtAddCss{ resize:both; display:block; background-color:#111; backgrond: #000; background:rgba(0,0,0,.9); color:#fff; border:1px solid #000; outline:none; width:400px; height:200px; font:13px/18px 'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace; padding: 10px; overflow: auto; resize: none; } #spAddCssHandle { border-width: 8px; border-style: solid; border-color: rgb(255, 255, 255) transparent transparent rgb(255, 255, 255); position: absolute; top: 0px; left: 0px; opacity: 0.1; cursor: nw-resize; } </style>").appendTo(g);var j=$("<textarea id='txtAddCss' spellcheck='false' />").appendTo(g).focus();var k=$("<span id='spAddCssHandle' />").appendTo(g);if(document.getElementById("styleAddCss").innerHTML!=="/**/"){bDynamicStyle=false;iThrottle=1000}(function(){function getCaret(a){if(a.selectionStart){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();if(b==null){return 0}var c=a.createTextRange(),d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return d.text.length}return 0};function setCaret(a,b){if(a.setSelectionRange){a.setSelectionRange(b,b)}else if(input.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}j.bind("keyup change",function(){throttle.keyup=throttle.keyup||setTimeout(function(){var a=j.val();if(bDynamicStyle){h.html(a)}else{h.replaceWith("<style id='styleAddCss'>"+a+"</style>");h=$(document.getElementById("styleAddCss"))}if(f){localStorage.addCss=a}throttle.keyup=undefined},iThrottle)}).bind("keydown",function(e){if(e.which===27){j.toggle()}else if(e.which===9){var a=j.val(),iCaret=getCaret(j[0]);j.val(a.substr(0,iCaret)+"\t"+a.substr(iCaret));iCaret++;setCaret(j[0],iCaret);return false}})}());if(f){if(localStorage.addCss){j.val(localStorage.addCss).change()}if(localStorage.addCssCss){j.css($.parseJSON(localStorage.addCssCss))}}(function(){var c={start:{},diff:{}},css={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};function fixToScreen(){var a=$window.width();var b=j.width();if(a<b+40){j.css("width",a-40)}css.start={width:j.width(),height:j.height()};throttle.windowResize=undefined}var d={startDrag:function(e){c.start={x:e.clientX||e.pageX,y:e.clientY||e.pageY};$(document).on("mousemove",d.onMouseMove);$(document).on("mouseup",d.endDrag);$(document).on("keypress",d.endDrag);return false},onMouseMove:function(e){c.diff.x=c.start.x-(e.clientX||e.pageX);c.diff.y=c.start.y-(e.clientY||e.pageY);css.end.width=css.start.width+c.diff.x;css.end.height=css.start.height+c.diff.y;j.css(css.end)},endDrag:function(e){if(f){localStorage.addCssCss=JSON.stringify(css.end)}c.diff={x:0,y:0},css={start:{width:j.width(),height:j.height()},end:{width:undefined,height:undefined}};$(document).off("mousemove",d.onMouseMove);$(document).off("mouseup",d.endDrag);$(document).off("keypress",d.endDrag);fixToScreen();return false}};k.on("mousedown",d.startDrag);$window.on("resize",function(){throttle.windowResize=throttle.windowResize||setTimeout(fixToScreen,10)}).resize()}())};window.addCss()}})();