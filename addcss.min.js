// http://rocktronica.github.com/Add-CSS-Bookmarklet/
(function(){function d(a){window.addCss=function(){function d(a,b){if(a.setSelectionRange){a.setSelectionRange(b,b)}else if(input.createTextRange){var c=a.createTextRange();c.collapse(true);c.moveEnd("character",b);c.moveStart("character",b);c.select()}}function c(a){if(a.selectionStart){return a.selectionStart}else if(document.selection){a.focus();var b=document.selection.createRange();if(b==null){return 0}var c=a.createTextRange(),d=c.duplicate();c.moveToBookmark(b.getBookmark());d.setEndPoint("EndToStart",c);return d.text.length}return 0}var a=window.jQuery,b;if(document.getElementById("txtAddCss")){a("#txtAddCss").toggle();return false}var e=function(){try{return"localStorage"in window&&window["localStorage"]!==null}catch(a){return false}}();var f=a("<div />").css({position:"fixed",bottom:"10px",right:"10px","z-index":"1000"}).appendTo(a("body"));var g=a("<style />").appendTo(a("body"));var h=a("<textarea id='txtAddCss' spellcheck='false' />").css({resize:"both",display:"block",background:"rgba(0,0,0,.9)",color:"#fff",border:"1px solid #000",outline:"none",width:"400px",height:"200px",font:'13px/18px "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace',padding:"10px",overflow:"auto",resize:"none"}).bind("keyup change",function(){b=b||setTimeout(function(){var a=h.val();g.html(a);if(e){localStorage.addCss=a}b=undefined},500)}).bind("keydown",function(a){if(a.which===27){h.toggle()}else if(a.which===9){var b=h.val(),e=c(h[0]);h.val(b.substr(0,e)+"\t"+b.substr(e));e++;d(h[0],e);return false}}).appendTo(f).focus();if(e){if(localStorage.addCss){h.val(localStorage.addCss).change()}if(localStorage.addCssCss){h.css(a.parseJSON(localStorage.addCssCss))}}var i={start:{},diff:{}},j={start:{width:h.width(),height:h.height()},end:{width:undefined,height:undefined}};var k={startDrag:function(b){i.start={x:b.clientX||b.pageX,y:b.clientY||b.pageY};a(document).on("mousemove",k.onMouseMove);a(document).on("mouseup",k.endDrag);return false},onMouseMove:function(a){i.diff.x=i.start.x-(a.clientX||a.pageX);i.diff.y=i.start.y-(a.clientY||a.pageY);j.end.width=j.start.width+i.diff.x;j.end.height=j.start.height+i.diff.y;h.css(j.end)},endDrag:function(b){if(e){localStorage.addCssCss=JSON.stringify(j.end)}i.diff={x:0,y:0},j={start:{width:h.width(),height:h.height()},end:{width:undefined,height:undefined}};a(document).off("mousemove",k.onMouseMove);a(document).off("mouseup",k.endDrag);return false}};var l=a("<span id='spAddCssHandle' />").css({border:"8px solid #fff",position:"absolute",top:0,left:0,"border-right-color":"transparent","border-bottom-color":"transparent",opacity:".1",cursor:"nw-resize"}).appendTo(f).on("mousedown",k.startDrag)};window.addCss()}var a="1.7";if(window.jQuery===undefined||window.jQuery.fn.jquery<a){var b=false;var c=document.createElement("script");c.src="http://ajax.googleapis.com/ajax/libs/jquery/"+a+"/jquery.min.js";c.onload=c.onreadystatechange=function(){if(!b&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){b=true;d(jQuery)}};document.getElementsByTagName("head")[0].appendChild(c)}else{d(jQuery)}})()